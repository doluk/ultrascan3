name: Windows MSVC

on: [push, pull_request, workflow_dispatch]

jobs:
  build:
    runs-on: windows-latest

    env:
      # Force vcpkg to use the MSVC triplet (Critical)
      VCPKG_DEFAULT_TRIPLET: x64-windows
      # Optimize vcpkg caching
      VCPKG_BINARY_SOURCES: "clear;x-gha,readwrite"

    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Setup vcpkg
        uses: lukka/run-vcpkg@v11
        with:
          vcpkgJsonGlob: '**/vcpkg.json'

      - name: Configure CMake
        run: >
          cmake -S . -B build -G "Visual Studio 17 2022" -A x64 `
          -DCMAKE_TOOLCHAIN_FILE="${{ env.VCPKG_ROOT }}/scripts/buildsystems/vcpkg.cmake" `
          -DVCPKG_TARGET_TRIPLET=x64-windows `
          -DVCPKG_MANIFEST_FEATURES="qt6" `
          -DCMAKE_CXX_STANDARD=17 `
          -DUSE_QT6=ON

      - name: Build
        run: cmake --build build --config Release
